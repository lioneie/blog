# 问题描述

dorado和netapp当nfs server，使用nfsv3挂载，停止任何操作等待10min以上，再执行`df -h`命令偶现执行时间超3s。使用nfsv4挂载，在一定条件下必现`df -h`命令执行时间超过40s。

# `tcpdump`抓包

- 2351.124940: SYN
- 2351.125149: SYN-ACK
- 2351.125167: RST
- 2354.176234: SYN
- 2354.176450: SYN-ACK
- 2354.176487: SYN

- SYN: 客户端向服务器发送一个SYN（同步）包，表示请求建立连接。这个包中包含客户端的初始序列号。
- SYN-ACK: 服务器收到SYN包后，返回一个SYN-ACK（同步-确认）包，表示同意建立连接，并且确认客户端的序列号。这个包中包含服务器的初始序列号。
- ACK: 客户端收到SYN-ACK包后，发送一个ACK（确认）包给服务器，确认接收到服务器的SYN-ACK。至此，连接建立完成，客户端和服务器可以开始数据传输。
- RST: 是TCP协议中的一种控制包，用于强制关闭一个连接。RST代表“Reset”，RST包的发送意味着连接的状态被立即清除，不需要进行正常的连接终止过程。它通常在以下几种情况下使用：
  - 异常关闭：当一方收到一个不期望的包（例如，连接已经关闭或不存在的连接）时，会发送RST包来通知对方重置连接。
  - 拒绝连接：当服务器收到一个连接请求（SYN），但不愿意或不能接受该请求时，可以发送RST包给客户端，以表明连接被拒绝。
  - 错误处理：在一些错误情况下，例如应用程序崩溃或无法处理接收到的数据，TCP栈可以发送RST包来重置连接。

# 日志分析

打开日志开关，复现后抓取日志:
```sh
echo 0xFFFF > /proc/sys/sunrpc/nfs_debug # NFSDBG_ALL
echo 0x7fff > /proc/sys/sunrpc/rpc_debug # RPCDBG_ALL
```

复现后抓到以下日志:
```sh
[504147.999833] RPC: 24902 call_start nfs4 proc GETATTR (sync)
...
[504188.043341] RPC: 24905 call_start nfs4 proc STATFS (sync)
```