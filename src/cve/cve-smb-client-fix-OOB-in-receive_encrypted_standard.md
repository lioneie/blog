CVE-2024-0565 修复补丁：[smb: client: fix OOB in receive_encrypted_standard()](https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=eec04ea119691e65227a97ce53c0da6b9b74b0b7)

# 4.19合补丁

因为主线代码文件夹经过了重命名`38c8a9a52082 smb: move client and server files to common directory fs/smb`，4.19要打上这个补丁，必须将`.patch`文件中的`smb/client`改成`cifs`:
```sh
sed -i 's/smb\/client/cifs/g' 0001-smb-client-fix-OOB-in-receive_encrypted_standard.patch
```

使用`git am 0001-smb-client-fix-OOB-in-receive_encrypted_standard.patch --reject`命令打上补丁后，会有冲突，不同的地方是：
```sh
--- a/fs/cifs/smb2ops.c
+++ b/fs/cifs/smb2ops.c
@@ -3218,7 +3218,7 @@ receive_encrypted_standard(struct TCP_Server_Info *server,
 {
        int ret, length;
        char *buf = server->smallbuf;
-       struct smb2_sync_hdr *shdr;
+       struct smb2_hdr *shdr;
        unsigned int pdu_length = server->pdu_size;
        unsigned int buf_size;
        struct mid_q_entry *mid_entry;
@@ -3248,7 +3248,7 @@ receive_encrypted_standard(struct TCP_Server_Info *server,
 
        next_is_large = server->large_buf;
 one_more:
-       shdr = (struct smb2_sync_hdr *)buf;
+       shdr = (struct smb2_hdr *)buf;
        if (shdr->NextCommand) {
                if (next_is_large)
                        next_buffer = (char *)cifs_buf_get();
```

在主线代码上使用`git blame fs/smb/client/smb2ops.c | grep "struct smb2_hdr \*shdr"`找到前置补丁`0d35e382e4e9 cifs: Create a new shared file holding smb2 pdu definitions`才能解决冲突，但此前置补丁与我们修改的内容无关，所以只需要手动处理冲突即可。