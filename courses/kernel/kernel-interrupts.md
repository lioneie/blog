# 几个概念

- 中断（interrupt）: 定义为一个事件，该事件改变cpu执行的指令顺序，分为同步中断和异步中断。同步（synchronous）中断: 只有在一条指令终止执行后cpu才会发出中断，同步中断称为异常。异步（asynchronous）中断: 由其他硬件设备随机产生的，如间隔定时器或I/O设备。一般我们所说的中断特指异步中断。
  - 可屏蔽中断（maskable interrupt）: I/O设备发出的所有中断请求都产生可屏蔽中断，控制单元忽略处理屏蔽状态（masked）的中断。
  - 不可屏蔽中断（nonmaskable interrupt）: 只有几个危急事件（如硬件故障）才引起不可屏蔽中断。
- 异常（exception）: 由程序的错误产生，或由内核必须处理的异常（如缺页）条件产生的。
  - 处理器探测异常（processor-detected exception）: cpu执行指令时探测到的反常条件所产生的异常。根据cpu产生异常时保存在x86的`eip`寄存器或arm64的`pc`寄存器中的值，可以分为3组:
    - 故障（fault）: 保存在x86的`eip`寄存器或arm64的`pc`寄存器中的值是引起故障的指令地址，异常处理程序执行完后，那条指令重新执行，如缺页异常，纠正引起缺页异常的反常条件后重新执行同一指令。
    - 陷阱（trap）: 保存在x86的`eip`寄存器或arm64的`pc`寄存器中的值是随后要执行的指令地址，只有当没有必要重新执行已终止的指令时，才触发陷阱，陷阱的主要用途是为了调试程序。
    - 异常中止（abort）: x86的`eip`寄存器或arm64的`pc`寄存器中不能保存引起异常的指令所在的确切位置，用于报告严重的错误，如硬件故障或系统表中无效的值或不一致的值。异常终止处理程序只能终止进程，别无选择。
  - 编程异常（programmed exception）: 编程者发出请求时发生。以下几种情况会发生编程异常: x86下`int`（用于触发中断）和`int3`（触发特定的中断3，用于断点），arm64的`SVC`（对应x86的`int`）和`BRK`（对应x86的`int3`），以及x86下的`into`（检查溢出）和`bound`（检查地址出界）指令检查的条件不为真时。控制单元把编程异常作为陷阱来处理，也叫软件中断（software interrupt），要注意的是软件中断和软中断（softirq）不是一个概念，编程异常有两种用途: 执行系统调用和给调试程序通报一个特定的事件。

# 系统调用

系统调用是用户进程和内核交互的接口，在用户空间进程和硬件设备之间添加一个中间层，系统调用为用户空间提供硬件的抽象接口，以及保证系统的稳定和安全，实现多任务和虚拟内在。

